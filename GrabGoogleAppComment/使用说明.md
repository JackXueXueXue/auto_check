# Git提交内容获取工具 - 使用说明

## 已完成的配置

✅ **已将内部GitLab地址固定为:** `http://git.server.tongbu.com/api/v4`

现在使用时不需要再手动指定 `--base-url` 参数，默认就会使用内部GitLab。

---

## 运行方式

### 方式1：VSCode 终端命令行运行（最简单）

1. 按 `Ctrl + ~` 打开VSCode终端
2. 运行命令：

```bash
python reviews_scraper.py --token "你的token" --project-id "项目ID"
```

**完整示例：**
```bash
# 获取最近10条提交
python reviews_scraper.py --token "glpat-xxxxxxxxxxxx" --project-id "123" --per-page 10

# 获取指定分支的提交
python reviews_scraper.py --token "glpat-xxxxxxxxxxxx" --project-id "123" --ref "master"

# 保存结果到JSON文件
python reviews_scraper.py --token "glpat-xxxxxxxxxxxx" --project-id "123" --output "commits.json"
```

---

### 方式2：使用 VSCode 启动配置（按F5运行）

1. 打开 `.vscode/launch.json` 文件
2. 修改以下参数为你的实际值：
   - `--token`: 替换 `"你的GitLab_Token"` 为你的实际token
   - `--project-id`: 替换 `"123"` 为你的项目ID
3. 按 `F5` 或点击"运行和调试"按钮

---

### 方式3：在Python代码中直接调用

参考 `test_example.py` 文件：

```python
from reviews_scraper import main

result = main(
    access_token='你的token',
    project_id='123',
    per_page=10
)

if result['success']:
    print(f"获取了 {result['count']} 条提交")
    for commit in result['commits']:
        print(commit['title'])
```

---

## 参数说明

| 参数 | 必需 | 说明 | 示例 |
|------|------|------|------|
| `--token` | ✅ 是 | GitLab访问令牌 | `glpat-xxxxxxxxxxxx` |
| `--project-id` | ✅ 是 | 项目ID | `123` |
| `--platform` | ❌ 否 | 平台类型，默认gitlab | `gitlab` 或 `github` |
| `--per-page` | ❌ 否 | 返回数量，默认20 | `10` |
| `--ref` | ❌ 否 | 分支或标签名 | `master` 或 `develop` |
| `--output` | ❌ 否 | 保存到JSON文件 | `commits.json` |
| `--base-url` | ❌ 否 | 已默认设置为内部GitLab | 不需要传 |

---

## 如何获取 GitLab Token？

1. 登录你的内部GitLab: http://git.server.tongbu.com/
2. 点击右上角头像 → Settings (设置)
3. 左侧菜单点击 "Access Tokens" (访问令牌)
4. 创建新令牌：
   - Name: 随便起个名字，如 "API Access"
   - Scopes: 勾选 `api` 或 `read_api`
   - 点击 "Create personal access token"
5. 复制生成的令牌（只显示一次！）

---

## 如何获取项目ID？

**方法1：** 在项目主页，项目名称下方会显示项目ID

**方法2：** 项目URL中的数字
- 例如：`http://git.server.tongbu.com/group/project/-/tree/master`
- 进入项目设置可以看到 Project ID

---

## 测试运行

修改 `test_example.py` 中的参数后，直接运行：

```bash
python test_example.py
```

---

## 返回数据结构

```python
{
    'success': True/False,  # 是否成功
    'commits': [            # 提交列表
        {
            'id': 'xxx',
            'short_id': 'xxx',
            'title': '提交标题',
            'message': '完整提交信息',
            'author_name': '作者名',
            'author_email': 'email',
            'authored_date': '2024-01-01T12:00:00.000+08:00',
            'web_url': 'http://git.server.tongbu.com/...'
        }
    ],
    'count': 10,           # 提交数量
    'error': None          # 错误信息（如果有）
}
```

---

## 常见问题

**Q: 报错 401 Unauthorized？**  
A: 检查token是否正确，或token权限是否足够（需要 api 或 read_api 权限）

**Q: 报错找不到项目？**  
A: 检查project_id是否正确，或你的token是否有访问该项目的权限

**Q: 网络连接超时？**  
A: 确认是否在公司内网环境，能否访问 http://git.server.tongbu.com/

