# 配置文件使用说明

## 📋 概述

现在所有配置都统一从 `config.json` 文件读取，**F5运行和命令行运行都使用同一个配置文件**。

---

## 🚀 快速开始

### 1. 创建配置文件

复制示例配置文件并填入你的信息：

```bash
# Windows
copy config.json.example config.json

# Linux/Mac
cp config.json.example config.json
```

### 2. 编辑 config.json

打开 `config.json`，填入你的实际配置：

```json
{
  "access_token": "你的GitLab_Token",
  "project_id": 304,
  "platform": "gitlab",
  "base_url": "http://git.server.tongbu.com/",
  "per_page": 1,
  "ref_name": "xxj_20251017_ios104开发",
  "include_diff": true
}
```

---

## 📝 配置项说明

| 配置项 | 类型 | 必填 | 说明 | 示例 |
|--------|------|-----|------|------|
| `access_token` | string | ✅ | GitLab/GitHub API访问令牌 | `"glpat-xxxxxxxxxxxx"` |
| `project_id` | integer | ✅ | 项目ID（GitLab）或仓库路径（GitHub） | `304` 或 `"owner/repo"` |
| `platform` | string | ❌ | 平台类型，默认 `gitlab` | `"gitlab"` 或 `"github"` |
| `base_url` | string | ❌ | API基础URL，默认内部GitLab | `"http://git.server.tongbu.com/"` |
| `per_page` | integer | ❌ | 返回的提交数量，默认 `10` | `10` |
| `ref_name` | string | ❌ | 分支或标签名称 | `"master"` 或 `"xxj_20251017_ios104开发"` |
| `include_diff` | boolean | ❌ | 是否获取改动内容，默认 `true` | `true` 或 `false` |

---

## 🎯 使用方式

### 方式1：F5运行（VSCode）

**完全从配置文件读取**：

1. 按 `F5` 或点击"运行和调试"
2. 选择配置：
   - `运行 Git提交获取工具（从config.json读取配置）` - 默认运行
   - `运行 Git提交获取工具（AI审核格式）` - 输出AI审核格式
   - `运行 Git提交获取工具（保存到文件）` - 保存JSON
   - `运行 Git提交获取工具（保存AI审核格式）` - 保存Markdown

**所有配置都从 `config.json` 读取，无需修改代码！**

---

### 方式2：命令行运行

#### 完全使用配置文件（推荐）

```bash
python reviews_scraper.py
```

所有参数都从 `config.json` 读取。

#### 部分覆盖配置

```bash
# 覆盖项目ID
python reviews_scraper.py --project-id 999

# 覆盖分支名称
python reviews_scraper.py --ref "other-branch"

# 覆盖多个参数
python reviews_scraper.py --project-id 999 --per-page 5 --ref "develop"
```

#### 指定其他配置文件

```bash
python reviews_scraper.py --config my-config.json
```

---

### 方式3：Python代码调用

```python
from reviews_scraper import main

# 完全从配置文件读取
result = main()

# 覆盖部分配置
result = main(per_page=5, ref_name='other-branch')
```

---

## 🔒 安全提示

1. **不要提交 `config.json` 到Git**：
   - 已自动添加到 `.gitignore`
   - `config.json` 包含敏感的 `access_token`

2. **使用 `config.json.example`**：
   - 这个文件可以提交到Git
   - 作为配置模板供其他开发者参考

---

## ✅ 配置优先级

配置的优先级（从高到低）：

1. **命令行参数**（最高优先级）
   ```bash
   python reviews_scraper.py --project-id 999  # 这个会覆盖配置文件
   ```

2. **函数参数**（在Python代码中调用时）
   ```python
   main(project_id=999)  # 这个会覆盖配置文件
   ```

3. **config.json 配置文件**
   ```json
   {
     "project_id": 304  // 如果上面两个都没传，就用这个
   }
   ```

4. **默认值**（最后备选）

---

## 🛠️ 修改配置

### 方法1：直接编辑 config.json（推荐）

直接修改 `config.json` 文件，所有运行方式都会使用新配置。

### 方法2：命令行临时覆盖

```bash
# 只运行一次，使用不同的项目ID
python reviews_scraper.py --project-id 999
```

---

## 📋 配置文件示例

### 完整示例

```json
{
  "access_token": "JyxNC-T2QxK-wDursXPs",
  "project_id": 304,
  "platform": "gitlab",
  "base_url": "http://git.server.tongbu.com/",
  "per_page": 1,
  "ref_name": "xxj_20251017_ios104开发",
  "include_diff": true
}
```

### 最小配置（只填必填项）

```json
{
  "access_token": "你的token",
  "project_id": 304
}
```

其他项会使用默认值。

---

## ❓ 常见问题

**Q: F5运行和命令行运行用的配置不一样？**  
A: 不会！现在统一从 `config.json` 读取，两者完全一致。

**Q: 如何切换不同的项目？**  
A: 修改 `config.json` 中的 `project_id`，或使用命令行参数临时覆盖。

**Q: 配置文件找不到怎么办？**  
A: 复制 `config.json.example` 为 `config.json`，或手动创建。

**Q: 可以在代码中硬编码参数吗？**  
A: 可以，但**不推荐**。建议统一使用配置文件管理。

---

现在所有配置都统一了，修改一次 `config.json`，F5和命令行都会生效！🎉

